<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>iZdo&#39;s Blog</title>
  <subtitle>bonbolu</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://izdo.github.io/"/>
  <updated>2017-04-06T12:43:58.165Z</updated>
  <id>https://izdo.github.io/</id>
  
  <author>
    <name>iZdo</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>围住神经猫游戏(二)</title>
    <link href="https://izdo.github.io/2017/04/05/%E5%9B%B4%E4%BD%8F%E7%A5%9E%E7%BB%8F%E7%8C%AB%E6%B8%B8%E6%88%8F(%E4%BA%8C)/"/>
    <id>https://izdo.github.io/2017/04/05/围住神经猫游戏(二)/</id>
    <published>2017-04-05T14:46:41.840Z</published>
    <updated>2017-04-06T12:43:58.165Z</updated>
    
    <content type="html"><![CDATA[<h1 id="使用Android制作围住神经猫游戏-二"><a href="#使用Android制作围住神经猫游戏-二" class="headerlink" title="使用Android制作围住神经猫游戏(二)"></a>使用Android制作围住神经猫游戏(二)</h1><h2 id="获取点击圆点的坐标"><a href="#获取点击圆点的坐标" class="headerlink" title="获取点击圆点的坐标"></a>获取点击圆点的坐标</h2><blockquote>
<ul>
<li>要响应屏幕的点击事件，需要实现OnTouchListener接口并重写其onTouch()方法。</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">PlayGround</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">       </div><div class="line">       ...</div><div class="line">       </div><div class="line">        setOnTouchListener(<span class="keyword">this</span>);</div><div class="line">        initGame();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>在PlayGround()中加入setOnTouchListener(this)，然后重写onTouch()方法。</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View view, MotionEvent motionEvent)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(motionEvent.getAction()==MotionEvent.ACTION_UP)</div><div class="line">        <span class="comment">//获取当前点击的x,y的坐标值</span></div><div class="line">        Toast.makeText(getContext(), motionEvent.getX()+<span class="string">":"</span>+motionEvent.getY(), Toast.LENGTH_SHORT).show();</div><div class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>通过if语句判断当前动作是否为ACTOIN_UP，然后通过Toast显示当前点击位置的坐标。</li>
</ul>
</blockquote>
<h3 id="部署到模拟器查看效果"><a href="#部署到模拟器查看效果" class="headerlink" title="部署到模拟器查看效果:"></a>部署到模拟器查看效果:</h3><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/iZdo/iZdo.github.io/blob/master/BlogImgs/Blog4/Blog4_1.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<h2 id="实现点击之后圆点颜色改变效果"><a href="#实现点击之后圆点颜色改变效果" class="headerlink" title="实现点击之后圆点颜色改变效果"></a>实现点击之后圆点颜色改变效果</h2><h3 id="修改onTouch-中的代码"><a href="#修改onTouch-中的代码" class="headerlink" title="修改onTouch()中的代码:"></a>修改onTouch()中的代码:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"> <span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View view, MotionEvent motionEvent)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (motionEvent.getAction() == MotionEvent.ACTION_UP) &#123;</div><div class="line">        <span class="comment">//获取当前点击的x,y的坐标值</span></div><div class="line">        <span class="comment">//Toast.makeText(getContext(), motionEvent.getX()+":"+motionEvent.getY(), Toast.LENGTH_SHORT).show();</span></div><div class="line">        <span class="keyword">int</span> x, y;</div><div class="line">        <span class="comment">// 获取当前点击的行数</span></div><div class="line">        y = (<span class="keyword">int</span>) (motionEvent.getY() / WIDTH);</div><div class="line">        <span class="keyword">if</span> (y % <span class="number">2</span> == <span class="number">0</span>) &#123;  <span class="comment">// 奇数行</span></div><div class="line">            x = (<span class="keyword">int</span>) (motionEvent.getX() / WIDTH);</div><div class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// 偶数行</span></div><div class="line">            x = (<span class="keyword">int</span>) ((motionEvent.getX() - WIDTH / <span class="number">2</span>) / WIDTH);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 判断点击位置是否越界</span></div><div class="line">        <span class="keyword">if</span> (x + <span class="number">1</span> &gt; COL || y + <span class="number">1</span> &gt; ROW)</div><div class="line">            initGame();</div><div class="line">        <span class="keyword">else</span></div><div class="line">            getDot(x, y).setStatus(Dot.STATUS_ON);</div><div class="line">        redraw();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>首先获取当前点击的行数，用当前点击的y坐标除以WIDTH即可获得。然后判断当前所点击位置是处于奇数行还是偶数行，因为由于偶数行有偏移所以这两种情况下的列数计算方式是不同的。计算没有偏移的行的列值与获取行数相同，而计算偏移的列值则需要当前点击位置的x坐标减去半个WIDTH后再除以WIDTH获得。</li>
<li>其次，为了避免我们点击到非圆点所在的位置，也就是游戏界面以外的空白区域造成越界，需要进行判断，如果所点位置越界，可以让其reutrn false，但是为了后边测试方便，这里设置成重新初始化游戏，如果所点位置不越界，就将其状态设置为已点击。</li>
<li>最后调用redraw()方法重绘界面。</li>
</ul>
</blockquote>
<h3 id="部署并观看效果："><a href="#部署并观看效果：" class="headerlink" title="部署并观看效果："></a>部署并观看效果：</h3><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/iZdo/iZdo.github.io/blob/master/BlogImgs/Blog4/Blog4_2.gif?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<blockquote>
<ul>
<li>可以看到，效果跟我们所说的那样。</li>
</ul>
</blockquote>
<h2 id="游戏逻辑——功能函数的实现"><a href="#游戏逻辑——功能函数的实现" class="headerlink" title="游戏逻辑——功能函数的实现"></a>游戏逻辑——功能函数的实现</h2><h3 id="修改PlayGround中的代码"><a href="#修改PlayGround中的代码" class="headerlink" title="修改PlayGround中的代码:"></a>修改PlayGround中的代码:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PlayGround</span> <span class="keyword">extends</span> <span class="title">SurfaceView</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnTouchListener</span> </span>&#123;</div><div class="line"></div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="comment">// 判断当前点是否处于边界</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isAtEdge</span><span class="params">(Dot d)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (d.getX() * d.getY() == <span class="number">0</span> || d.getX() + <span class="number">1</span> == COL || d.getY() + <span class="number">1</span> == ROW)</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 获取当前点周围六个点</span></div><div class="line">    <span class="function"><span class="keyword">private</span> Dot <span class="title">getNeighbour</span><span class="params">(Dot one, <span class="keyword">int</span> dir)</span> </span>&#123;</div><div class="line">        <span class="keyword">switch</span> (dir) &#123;</div><div class="line">            <span class="comment">// 左</span></div><div class="line">            <span class="keyword">case</span> <span class="number">1</span>:</div><div class="line">                <span class="keyword">return</span> getDot(one.getX() - <span class="number">1</span>, one.getY());</div><div class="line">            <span class="comment">// 左上</span></div><div class="line">            <span class="keyword">case</span> <span class="number">2</span>:</div><div class="line">                <span class="keyword">if</span> (one.getY() % <span class="number">2</span> == <span class="number">0</span>) &#123; <span class="comment">// 偶数行</span></div><div class="line">                    <span class="keyword">return</span> getDot(one.getX() - <span class="number">1</span>, one.getY() - <span class="number">1</span>);</div><div class="line">                &#125; <span class="keyword">else</span> &#123; <span class="comment">// 奇数行</span></div><div class="line">                    <span class="keyword">return</span> getDot(one.getX(), one.getY() - <span class="number">1</span>);</div><div class="line">                &#125;</div><div class="line">                <span class="comment">// 右上</span></div><div class="line">            <span class="keyword">case</span> <span class="number">3</span>:</div><div class="line">                <span class="keyword">if</span> (one.getY() % <span class="number">2</span> == <span class="number">0</span>) &#123; <span class="comment">// 偶数行</span></div><div class="line">                    <span class="keyword">return</span> getDot(one.getX(), one.getY() - <span class="number">1</span>);</div><div class="line">                &#125; <span class="keyword">else</span> &#123; <span class="comment">// 奇数行</span></div><div class="line">                    <span class="keyword">return</span> getDot(one.getX() + <span class="number">1</span>, one.getY() - <span class="number">1</span>);</div><div class="line">                &#125;</div><div class="line">                <span class="comment">// 右</span></div><div class="line">            <span class="keyword">case</span> <span class="number">4</span>:</div><div class="line">                <span class="keyword">return</span> getDot(one.getX() + <span class="number">1</span>, one.getY());</div><div class="line">            <span class="comment">// 右下</span></div><div class="line">            <span class="keyword">case</span> <span class="number">5</span>:</div><div class="line">                <span class="keyword">if</span> (one.getY() % <span class="number">2</span> == <span class="number">0</span>) &#123; <span class="comment">// 偶数行</span></div><div class="line">                    <span class="keyword">return</span> getDot(one.getX(), one.getY() + <span class="number">1</span>);</div><div class="line">                &#125; <span class="keyword">else</span> &#123; <span class="comment">// 奇数行</span></div><div class="line">                    <span class="keyword">return</span> getDot(one.getX() + <span class="number">1</span>, one.getY() + <span class="number">1</span>);</div><div class="line">                &#125;</div><div class="line">                <span class="comment">// 左下</span></div><div class="line">            <span class="keyword">case</span> <span class="number">6</span>:</div><div class="line">                <span class="keyword">if</span> (one.getY() % <span class="number">2</span> == <span class="number">0</span>) &#123; <span class="comment">// 偶数行</span></div><div class="line">                    <span class="keyword">return</span> getDot(one.getX() - <span class="number">1</span>, one.getY() + <span class="number">1</span>);</div><div class="line">                &#125; <span class="keyword">else</span> &#123; <span class="comment">// 奇数行</span></div><div class="line">                    <span class="keyword">return</span> getDot(one.getX(), one.getY() + <span class="number">1</span>);</div><div class="line">                &#125;</div><div class="line">            <span class="keyword">default</span>:</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 获得距离</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getDistance</span><span class="params">(Dot one, <span class="keyword">int</span> dir)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> distance = <span class="number">0</span>;</div><div class="line">        Dot ori = one, next;</div><div class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</div><div class="line">            <span class="comment">// 获取周围的点</span></div><div class="line">            next = getNeighbour(ori, dir);</div><div class="line">            <span class="comment">// 遇到障碍</span></div><div class="line">            <span class="keyword">if</span> (next.getStatus() == Dot.STATUS_ON)</div><div class="line">                <span class="keyword">return</span> distance * -<span class="number">1</span>;</div><div class="line">            <span class="comment">// 无障碍</span></div><div class="line">            <span class="keyword">if</span> (isAtEdge(next)) &#123;</div><div class="line">                distance++;</div><div class="line">                <span class="keyword">return</span> distance;</div><div class="line">            &#125;</div><div class="line">            distance++;</div><div class="line">            ori = next;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 移动猫</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">MoveTo</span><span class="params">(Dot one)</span> </span>&#123;</div><div class="line">        one.setStatus(Dot.STATUS_IN);</div><div class="line">        getDot(cat.getX(), cat.getY()).setStatus(Dot.STATUS_OFF);</div><div class="line">        cat.setXY(one.getX(), one.getY());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    ...</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>这里我们主要加入了四个方法: isAtEdge(),getNeighbour(),getDistance(),MoveTo(),接下来我会一一解释这几个方法的作用。<h4 id="isAtEdge"><a href="#isAtEdge" class="headerlink" title="isAtEdge()"></a>isAtEdge()</h4></li>
<li>这个方法用来判断当前点是否处于边界，d.getX() * d.getY() == 0表示的是x和y中只要其中一个为0，相乘的结果也肯定为0，所以包含了上和左边界的判断，而d.getX() + 1 == COL || d.getY() + 1 == ROW分别是右边界和下边界的判断。<h4 id="getNeighbour"><a href="#getNeighbour" class="headerlink" title="getNeighbour()"></a>getNeighbour()</h4></li>
<li>这个方法用来获取当前点周围的六个点，首先我们需要对周围的点进行分析:</li>
<li>当前点的左右两边的坐标分别是(x-1,y)和(x+1,y)，这是毋庸置疑的，但是在左上，右上，右下，左下这四个点的位置是会因为当前点所在的行是奇数行还是偶数行而不同的。</li>
<li>在此我们规定当前点的左，左上，右上，右，右下，左下方向分别由数字1-6表示(后面都用数字来代表方向)，因此getNeighbour()方法需要两个参数，一个是当前点，另一个是方向值。</li>
<li>接着用一个switch语句进行判断当前需要获取的方向的点，1,4方向是固定的，而2,3,5,6方向需要分奇偶行。</li>
<li>在此之前，我已经将具体的情况通过图片绘制出来，先观察一下下面两幅图:</li>
</ul>
</blockquote>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/iZdo/iZdo.github.io/blob/master/BlogImgs/Blog4/Blog4_3.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/iZdo/iZdo.github.io/blob/master/BlogImgs/Blog4/Blog4_4.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<blockquote>
<ul>
<li>相信上面两幅图已经很好地诠释了周围的点的坐标值，接下来用one.getY() % 2 == 0判断当前点位于奇数行还是偶数行，然后将相应的点获取并return即可，这里不再多做解释。<h4 id="getDistance"><a href="#getDistance" class="headerlink" title="getDistance()"></a>getDistance()</h4></li>
<li>这个方法用于获取当前点指定方向到边界的距离，首先定义一个距离值distance和两个Dot类型的变量ori、next，ori用来存储当前点(由于当前点在此方法中会不断变化，所以需要用一个新的Dot类型来存储，否则在后面的while循环中会进入死循环)，next用来存储当前点的下一个点。</li>
<li>然后通过一个while循环不断的获取到下一个点，并将distance自增。</li>
<li>而在获取下一个点之前需要进行判断，当下一个点为障碍点时，将返回一个负数的distance，而如果直到边界都一路畅通，没有障碍的话就返回一个正数的distance，通过正负数，当前点在此方向上是否有障碍一目了然，这里可以进行一个测试。<h5 id="修改onTouch-中的方法"><a href="#修改onTouch-中的方法" class="headerlink" title="修改onTouch()中的方法:"></a>修改onTouch()中的方法:</h5></li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View view, MotionEvent motionEvent)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (motionEvent.getAction() == MotionEvent.ACTION_UP) &#123;</div><div class="line">            </div><div class="line">            ...</div><div class="line">            </div><div class="line">            <span class="comment">// 判断点击位置是否越界</span></div><div class="line">            <span class="keyword">if</span> (x + <span class="number">1</span> &gt; COL || y + <span class="number">1</span> &gt; ROW)</div><div class="line">                <span class="comment">//return true;</span></div><div class="line">                <span class="comment">//initGame();</span></div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">7</span>; i++) &#123;</div><div class="line">                    Log.d(<span class="string">"-----------"</span>, <span class="string">"第"</span> + i + <span class="string">"个方向的距离为："</span> + getDistance(cat, i));</div><div class="line">                &#125;</div><div class="line">                </div><div class="line">           ...</div><div class="line">           </div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>将initGame()方法注释掉，然后用一个for循环打印出当前猫所在点六个方向上的距离值。<h5 id="部署项目并观看效果"><a href="#部署项目并观看效果" class="headerlink" title="部署项目并观看效果:"></a>部署项目并观看效果:</h5><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/iZdo/iZdo.github.io/blob/master/BlogImgs/Blog4/Blog4_5.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
</li>
</ul>
</blockquote>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/iZdo/iZdo.github.io/blob/master/BlogImgs/Blog4/Blog4_6.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<blockquote>
<ul>
<li>可以看到，当前猫所在点的六个方向上的距离值与打印出来的结果一一对应。</li>
<li>这里只是做一个测试，测试之后记得将越界时的逻辑还原成initGame()。</li>
</ul>
</blockquote>
<h4 id="MoveTo"><a href="#MoveTo" class="headerlink" title="MoveTo()"></a>MoveTo()</h4><blockquote>
<ul>
<li>这个方法用于将猫移动至指定点。</li>
<li><p>首选将当前传入的点的status设置为STATUS_IN,即猫在这个点上，然后将当前猫所在点的status设置为STATUS_OFF，最后再将猫设置到新的点上。</p>
</li>
<li><p>这样，游戏逻辑的实现就完成了一半了。</p>
</li>
</ul>
</blockquote>
<h2 id="游戏逻辑——基本移动策略"><a href="#游戏逻辑——基本移动策略" class="headerlink" title="游戏逻辑——基本移动策略"></a>游戏逻辑——基本移动策略</h2><h3 id="修改PlayGround中的代码-1"><a href="#修改PlayGround中的代码-1" class="headerlink" title="修改PlayGround中的代码"></a>修改PlayGround中的代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PlayGround</span> <span class="keyword">extends</span> <span class="title">SurfaceView</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnTouchListener</span> </span>&#123;</div><div class="line"></div><div class="line">    ...</div><div class="line">    </div><div class="line">    <span class="comment">// 让猫走动</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">move</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 判断猫是否在场景边界</span></div><div class="line">        <span class="keyword">if</span> (isAtEdge(cat)) &#123;</div><div class="line">            lose();</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 判断猫是否被路障包围</span></div><div class="line">        Vector&lt;Dot&gt; avaliable = <span class="keyword">new</span> Vector&lt;&gt;();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">7</span>; i++) &#123;</div><div class="line">            Dot n = getNeighbour(cat, i);</div><div class="line">            <span class="keyword">if</span> (n.getStatus() == Dot.STATUS_OFF) &#123;</div><div class="line">                avaliable.add(n);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (avaliable.size() == <span class="number">0</span>)</div><div class="line">            win();</div><div class="line">        <span class="keyword">else</span></div><div class="line">            MoveTo(avaliable.get(<span class="number">0</span>));</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 游戏失败</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">lose</span><span class="params">()</span> </span>&#123;</div><div class="line">        Toast.makeText(getContext(), <span class="string">"Lose"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 游戏成功</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">win</span><span class="params">()</span> </span>&#123;</div><div class="line">        Toast.makeText(getContext(), <span class="string">"You Win！"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View view, MotionEvent motionEvent)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (motionEvent.getAction() == MotionEvent.ACTION_UP) &#123;</div><div class="line">            <span class="comment">//获取当前点击的x,y的坐标值</span></div><div class="line">            <span class="comment">//Toast.makeText(getContext(), motionEvent.getX()+":"+motionEvent.getY(), Toast.LENGTH_SHORT).show();</span></div><div class="line">            <span class="keyword">int</span> x, y;</div><div class="line">            <span class="comment">// 获取当前点击的行数</span></div><div class="line">            y = (<span class="keyword">int</span>) (motionEvent.getY() / WIDTH);</div><div class="line">            <span class="keyword">if</span> (y % <span class="number">2</span> == <span class="number">0</span>) &#123;  <span class="comment">// 奇数行</span></div><div class="line">                x = (<span class="keyword">int</span>) (motionEvent.getX() / WIDTH);</div><div class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// 偶数行</span></div><div class="line">                x = (<span class="keyword">int</span>) ((motionEvent.getX() - WIDTH / <span class="number">2</span>) / WIDTH);</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// 判断点击位置是否越界</span></div><div class="line">            <span class="keyword">if</span> (x + <span class="number">1</span> &gt; COL || y + <span class="number">1</span> &gt; ROW)</div><div class="line">                <span class="comment">//return true;</span></div><div class="line">                initGame();</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (getDot(x, y).getStatus() == Dot.STATUS_OFF) &#123;</div><div class="line">                getDot(x, y).setStatus(Dot.STATUS_ON);</div><div class="line">                move();</div><div class="line">            &#125;</div><div class="line">            redraw();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>在PlayGround中添加move()方法，lose()方法以及win()方法。</li>
<li>lose()和win()比较简单，只是负责显示相应的Toast。</li>
<li>而在onTouch()方法中，将else修改成 else if (getDot(x, y).getStatus() == Dot.STATUS_OFF)是为了防止猫所在的点被点击之后变成STATUS_ON状态，这样修改之后就算点击猫所在的点状态也不会发生改变了，接着再调用move()方法。<h4 id="move"><a href="#move" class="headerlink" title="move()"></a>move()</h4></li>
<li>这个方法用于实现让猫走动的逻辑。</li>
<li>首先我们要考虑两个情况:1.当前猫是否处于场景边界 2.当前猫是否已经被路障包围</li>
<li>因此我们需要作出判断，当猫处于边界的话，就调用lose()方法并return结束游戏;而判断猫是否被包围则复杂一点，首先我们创建一个Vector集合用于存储猫周围的点，表示猫被多少个路障围住，然后用一个for循环判断猫周围六个点的状态，若点的状态为STATUS_OFF，则表示还未被设置成路障，将其放入Vector集合中，判断完所有的点后，若集合中没有任何元素，则表明猫周围没有可走的点，游戏胜利，否则调用MoveTo()让猫移动。</li>
</ul>
</blockquote>
<h3 id="运行程序"><a href="#运行程序" class="headerlink" title="运行程序:"></a>运行程序:</h3><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/iZdo/iZdo.github.io/blob/master/BlogImgs/Blog4/Blog4_7.gif?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/iZdo/iZdo.github.io/blob/master/BlogImgs/Blog4/Blog4_8.gif?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<blockquote>
<ul>
<li>可以看到，猫已经可以走动了，但是我们在MoveTo()的时候，传入的是avaliable.get(0)，这样固定猫的走法的话，玩家在多次游戏之后很容易就能找到猫移动的规律，所以接下来还要对猫移动的算法逻辑进行优化。</li>
</ul>
</blockquote>
<h2 id="优化游戏逻辑"><a href="#优化游戏逻辑" class="headerlink" title="优化游戏逻辑"></a>优化游戏逻辑</h2><h3 id="修改move-中的代码"><a href="#修改move-中的代码" class="headerlink" title="修改move()中的代码:"></a>修改move()中的代码:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 让猫走动</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">move</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// 判断猫是否在场景边界</span></div><div class="line">    <span class="keyword">if</span> (isAtEdge(cat)) &#123;</div><div class="line">        lose();</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 判断猫是否被路障包围</span></div><div class="line">    Vector&lt;Dot&gt; avaliable = <span class="keyword">new</span> Vector&lt;&gt;();</div><div class="line">    Vector&lt;Dot&gt; positive = <span class="keyword">new</span> Vector&lt;&gt;();</div><div class="line">    HashMap&lt;Dot, Integer&gt; al = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">7</span>; i++) &#123;</div><div class="line">        Dot n = getNeighbour(cat, i);</div><div class="line">        <span class="keyword">if</span> (n.getStatus() == Dot.STATUS_OFF) &#123;</div><div class="line">            avaliable.add(n);</div><div class="line">            al.put(n, i);</div><div class="line">            <span class="keyword">if</span> (getDistance(n, i) &gt; <span class="number">0</span>) &#123;</div><div class="line">                positive.add(n);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (avaliable.size() == <span class="number">0</span>)</div><div class="line">        win();</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (avaliable.size() == <span class="number">1</span>)</div><div class="line">        MoveTo(avaliable.get(<span class="number">0</span>));</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        Dot best = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">if</span> (positive.size() != <span class="number">0</span>) &#123; <span class="comment">// 存在可以直接到达边界的走向</span></div><div class="line">            <span class="keyword">int</span> min = <span class="number">9999</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; positive.size(); i++) &#123;</div><div class="line">                <span class="keyword">int</span> a = getDistance(positive.get(i), al.get(positive.get(i)));</div><div class="line">                <span class="keyword">if</span> (a &lt; min) &#123;</div><div class="line">                    min = a;</div><div class="line">                    best = positive.get(i);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// 所有方向都存在路障</span></div><div class="line">            <span class="keyword">int</span> max = <span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; avaliable.size(); i++) &#123;</div><div class="line">                <span class="keyword">int</span> k = getDistance(avaliable.get(i), al.get(avaliable.get(i)));</div><div class="line">                <span class="keyword">if</span> (k &lt;= max) &#123;</div><div class="line">                    max = k;</div><div class="line">                    best = avaliable.get(i);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        MoveTo(best);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>首先将条件语句进行了修改，当可走点只有一个的时候，就只能选择那个方向，而当可选的点有两个以上的时候，就<strong>从没有路障的所有方向中选出离边界最近的路</strong>，具体实现逻辑是这样的:</li>
<li>定义一个Vector集合来存储当前点的六个方向中没有路障(即可以直接到达边界)的方向。然后在进行判断周围的点是否为STATUS_OFF之后再进行一次判断，用getDistance()获得的是正数或者负数来判断是否有直接到达边界的方向，若有，则添加进positive集合。</li>
<li>现在实现当可选的点有两个以上时的具体逻辑，首先定义一个Dot类型的best，用来存储最符合当前情况的下一个位置的点，然后进行判断，判断的情况有两种：1.positive里有元素，即当前点存在可以直接到达边界的方向;2.positive里没有元素，即所有方向都存在路障。针对这两种情况进行逻辑的修改。<h4 id="当前点存在可以直接到达边界的方向"><a href="#当前点存在可以直接到达边界的方向" class="headerlink" title="当前点存在可以直接到达边界的方向"></a>当前点存在可以直接到达边界的方向</h4></li>
<li>在这种情况下，我们就需要找出这些可以直达边界的方向中最短的那个，以达到可以最快到达边界的目的。</li>
<li>首先创建一个int类型的min，用于存放最短路径，初始值尽可能地大，所以设置为9999。</li>
<li>接着通过一个for循环从可以直达边界的所有点的集合(即positive)中找出最短的路径，但是现在却出现了一个问题，我们需要从positive中取出点，一个一个进行判断，但我们并不知道这些点具体是哪个方向的，而且存入positive时我们也没有做相应的记录，所以这时候就需要用到一个HashMap来存储这个点对于源点来说是哪个方向的。</li>
<li>创建HashMap集合al，并在判断点的状态是否为STATUS_OFF之后将这个点以及方向放入al中，即al.put(n, i)。这样我们就可以不管加入positive的点的顺序，轻而易举地知道这些点的方向了。</li>
<li>继续之前的逻辑，定义一个int类型的a用来存储positive中的点的distance长度，而方向直接到al集合中取即可:al.get(avaliable.get(i))。最后进行判断，如果这个点的distance值a比min小，则将min的值修改为a，并且best也修改为这个点。</li>
</ul>
</blockquote>
<h4 id="所有方向都存在路障"><a href="#所有方向都存在路障" class="headerlink" title="所有方向都存在路障"></a>所有方向都存在路障</h4><blockquote>
<ul>
<li>通过上面的分析，这种情况下的逻辑就比较容易理解了，基本差不多。</li>
<li>区别就是，当所有方向都存在路障的话，需要找出所有点距离路障的长度中，最大的那个长度值，因为只有往离路障越远的距离的方向走，猫逃出路障的几率才会更大。</li>
<li>这里定义一个int类型的max，用于存放最长路径，而且初始值要尽可能地小，这里就设置为0，而后面的操作基本都差不多。<br>*　需要注意的是，判断条件为k&lt;=max，这是由于我们前文中将存在路障的路径的长度值设置为负数，而负数越大，其绝对值越小，所以判断条件才会是k&lt;=max。</li>
<li>最后无论是哪种情况，都需要将猫移动到best。</li>
</ul>
</blockquote>
<h3 id="部署游戏："><a href="#部署游戏：" class="headerlink" title="部署游戏："></a>部署游戏：</h3><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/iZdo/iZdo.github.io/blob/master/BlogImgs/Blog4/Blog4_9.gif?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<blockquote>
<ul>
<li><p>可以明显看出，猫的移动没有之前那样容易找出规律了。</p>
</li>
<li><p>这样游戏基本就完成了，虽然UI并没有真正的围住神经猫游戏美观，但是游戏的具体逻辑算是比较完整了，这仅仅是一个demo，就不追求完美了。</p>
</li>
</ul>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;使用Android制作围住神经猫游戏-二&quot;&gt;&lt;a href=&quot;#使用Android制作围住神经猫游戏-二&quot; class=&quot;headerlink&quot; title=&quot;使用Android制作围住神经猫游戏(二)&quot;&gt;&lt;/a&gt;使用Android制作围住神经猫游戏(二)&lt;/h1
    
    </summary>
    
      <category term="Android" scheme="https://izdo.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://izdo.github.io/tags/Android/"/>
    
      <category term="demo" scheme="https://izdo.github.io/tags/demo/"/>
    
  </entry>
  
  <entry>
    <title>围住神经猫游戏(一)</title>
    <link href="https://izdo.github.io/2017/03/29/%E5%9B%B4%E4%BD%8F%E7%A5%9E%E7%BB%8F%E7%8C%AB%E6%B8%B8%E6%88%8F(%E4%B8%80)/"/>
    <id>https://izdo.github.io/2017/03/29/围住神经猫游戏(一)/</id>
    <published>2017-03-29T06:23:06.543Z</published>
    <updated>2017-04-06T12:43:50.636Z</updated>
    
    <content type="html"><![CDATA[<h1 id="使用Android制作围住神经猫游戏-一"><a href="#使用Android制作围住神经猫游戏-一" class="headerlink" title="使用Android制作围住神经猫游戏(一)"></a>使用Android制作围住神经猫游戏(一)</h1><h2 id="新建工程CatchCrazyCat"><a href="#新建工程CatchCrazyCat" class="headerlink" title="新建工程CatchCrazyCat"></a>新建工程CatchCrazyCat</h2><h2 id="新建Java类PlayGround作为游戏背景"><a href="#新建Java类PlayGround作为游戏背景" class="headerlink" title="新建Java类PlayGround作为游戏背景"></a>新建Java类PlayGround作为游戏背景</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.catchcrazycat;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.graphics.Canvas;</div><div class="line"><span class="keyword">import</span> android.graphics.Color;</div><div class="line"><span class="keyword">import</span> android.view.SurfaceHolder;</div><div class="line"><span class="keyword">import</span> android.view.SurfaceView;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by iZdo on 2017/3/28.</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PlayGround</span> <span class="keyword">extends</span> <span class="title">SurfaceView</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PlayGround</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">redraw</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 获得Canvas画布实例</span></div><div class="line">        Canvas c = getHolder().lockCanvas();</div><div class="line">        <span class="comment">// 使用Canvas绘制背景</span></div><div class="line">        c.drawColor(Color.LTGRAY);</div><div class="line">        <span class="comment">// 设置背景</span></div><div class="line">        getHolder().unlockCanvasAndPost(c);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 为SurfaceHolder添加回调</span></div><div class="line">    SurfaceHolder.Callback callback = <span class="keyword">new</span> SurfaceHolder.Callback() &#123;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">surfaceCreated</span><span class="params">(SurfaceHolder surfaceHolder)</span> </span>&#123;</div><div class="line">            <span class="comment">// 在surface初始化时调用redraw()方法</span></div><div class="line">            redraw();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">surfaceChanged</span><span class="params">(SurfaceHolder surfaceHolder, <span class="keyword">int</span> i, <span class="keyword">int</span> i1, <span class="keyword">int</span> i2)</span> </span>&#123;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">surfaceDestroyed</span><span class="params">(SurfaceHolder surfaceHolder)</span> </span>&#123;</div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>PlayGround类需要继承自SurfaceView<h3 id="SurfaceView介绍"><a href="#SurfaceView介绍" class="headerlink" title="SurfaceView介绍"></a>SurfaceView介绍</h3></li>
<li>SurfaceView是继承自View用于显示图像的组件的。SurfaceView最大的特点就是它的双缓冲技术，所谓的双缓冲技术就是在它内部有两个线程，比如线程AB，当线程A更新界面时，B进行后台计算操作，当两个线程都完成各自的任务时，它们就会互相交换，A进行后台运算，B进行界面更新，两个线程无限循环交替更新和计算。由于SurfaceView的这种特性可以避免画图任务繁重而造成主线程阻塞，从而提高了程序的反应速度，因此在游戏开发中多用到SurfaceView，例如游戏中的背景、人物、动画等。</li>
<li>上面代码中我们首先在redraw()方法中通过getHolder获取SurfaceHolder，接着调用其lockCanvas()方法获取Canvas实例，然后调用drawColor()绘制背景，再调用unlockCanvasAndPost()方法将绘制的背景设置到SurfaceView界面上。</li>
<li>如果在onCreate()方法执行时，SurfaceHolder还没有完全创建好，这时候就会出现异常，这就需要给SurfaceHolder添加回调了。创建一个新的回调Callback，Callback是一个接口，所以需要重写其三个方法:surfaceCreated()、surfaceChanged()、surfaceDestroyed()，这三个方法分别是在surfaceView的holder被创建、被销毁以及surfaceView的大小发生变化时调用。</li>
<li>这里我们只需要在holder创建时调用redraw()方法即可。</li>
<li>最后再构造函数中添加Callback。</li>
</ul>
</blockquote>
<h3 id="Canvas介绍"><a href="#Canvas介绍" class="headerlink" title="Canvas介绍"></a>Canvas介绍</h3><blockquote>
<ul>
<li>通常情况下，要在Android中绘图，需要创建一个集成自View的视图，并且在该类中重写其onDraw(Canvas canvas)方法，然后在Activity中添加该视图，这里需要传入一个Canvas协助绘图。Canvas类代表画布，通过该类提供的方法，可以绘制各种图形。</li>
</ul>
</blockquote>
<h2 id="修改MainActivity"><a href="#修改MainActivity" class="headerlink" title="修改MainActivity"></a>修改MainActivity</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.catchcrazycat;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        <span class="comment">//setContentView(R.layout.activity_main);</span></div><div class="line">        setContentView(<span class="keyword">new</span> PlayGround(<span class="keyword">this</span>));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>这里我们将原先加载的布局换成我们定义的PlayGround并传入上下文。</li>
</ul>
</blockquote>
<h3 id="部署到Genymotion观看效果"><a href="#部署到Genymotion观看效果" class="headerlink" title="部署到Genymotion观看效果:"></a>部署到Genymotion观看效果:</h3><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/iZdo/iZdo.github.io/blob/master/BlogImgs/Bolg3/Blog3_1.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<h2 id="创建Java类Dot"><a href="#创建Java类Dot" class="headerlink" title="创建Java类Dot"></a>创建Java类Dot</h2><blockquote>
<ul>
<li>这个类用于记录所有点的xy坐标以及它的状态。</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.catchcrazycat;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by iZdo on 2017/3/28.</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dot</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> x, y;</div><div class="line">    <span class="keyword">int</span> status;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STATUS_ON = <span class="number">1</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STATUS_OFF = <span class="number">2</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STATUS_IN = <span class="number">3</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Dot</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.x = x;</div><div class="line">        <span class="keyword">this</span>.y = y;</div><div class="line">        status = STATUS_OFF;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getX</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> x;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setX</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.x = x;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getY</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> y;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setY</span><span class="params">(<span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.y = y;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getStatus</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> status;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStatus</span><span class="params">(<span class="keyword">int</span> status)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.status = status;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setXY</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.x = x;</div><div class="line">        <span class="keyword">this</span>.y = y;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>首先创建int类型的x，y用于存储点的横纵坐标，然后创建一个status用于记录当前点的状态。</li>
<li>然后定义三个常量分别用于表示点的三种状态:点未被点(OFF)，点已被点(ON),猫在点中。</li>
<li>定义一个带参构造器，并将status的状态设置为STATUS_OFF。</li>
<li>除了给x，y，status提供对应的get、set方法之外，还需要提供一个setxy()方法用于设置xy。</li>
</ul>
</blockquote>
<h2 id="修改PlayGround中的代码"><a href="#修改PlayGround中的代码" class="headerlink" title="修改PlayGround中的代码"></a>修改PlayGround中的代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.catchcrazycat;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.graphics.Canvas;</div><div class="line"><span class="keyword">import</span> android.graphics.Color;</div><div class="line"><span class="keyword">import</span> android.view.SurfaceHolder;</div><div class="line"><span class="keyword">import</span> android.view.SurfaceView;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by iZdo on 2017/3/28.</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PlayGround</span> <span class="keyword">extends</span> <span class="title">SurfaceView</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ROW = <span class="number">10</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> COL = <span class="number">10</span>;</div><div class="line">    <span class="comment">// 随机添加的路障数量</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BLOCKS = <span class="number">15</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Dot matrix[][];</div><div class="line">    <span class="keyword">private</span> Dot cat;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PlayGround</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">        getHolder().addCallback(callback);</div><div class="line">        matrix = <span class="keyword">new</span> Dot[ROW][COL];</div><div class="line">        <span class="comment">// 将二维数组所有数据初始化为Dot类型</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ROW; i++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; COL; j++) &#123;</div><div class="line">                matrix[i][j] = <span class="keyword">new</span> Dot(j, i);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        initGame();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 获取指定坐标的对应点</span></div><div class="line">    <span class="function"><span class="keyword">private</span> Dot <span class="title">getDot</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> matrix[y][x];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="comment">// 初始化所有点</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initGame</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ROW; i++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; COL; j++) &#123;</div><div class="line">                matrix[i][j].setStatus(Dot.STATUS_OFF);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        cat = <span class="keyword">new</span> Dot(<span class="number">4</span>, <span class="number">5</span>);</div><div class="line">        getDot(<span class="number">4</span>, <span class="number">5</span>).setStatus(Dot.STATUS_IN);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; BLOCKS; ) &#123;</div><div class="line">            <span class="keyword">int</span> x = (<span class="keyword">int</span>) ((Math.random() * <span class="number">1000</span>) % COL);</div><div class="line">            <span class="keyword">int</span> y = (<span class="keyword">int</span>) ((Math.random() * <span class="number">1000</span>) % ROW);</div><div class="line">            <span class="keyword">if</span> (getDot(x, y).getStatus() == Dot.STATUS_OFF) &#123;</div><div class="line">                getDot(x, y).setStatus(Dot.STATUS_ON);</div><div class="line">                i++;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>我们先来看看围住神经猫游戏的主界面:</li>
</ul>
</blockquote>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/iZdo/iZdo.github.io/blob/master/BlogImgs/Bolg3/Blog3_2.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<blockquote>
<ul>
<li>可以看到，游戏主界面的背景是一个多行多列的方阵(行之间有偏移，但后面可以解决),所以我们可以用二维数组来储存。</li>
<li>创建数据类型为Dot的二维数组matrix[][]，在构造方法PlayGround()中用两层for循环将二维数组所有数据初始化。</li>
<li>在初始化点时，可以看到: matrix[i][j] = new Dot(j, i); matrix的第i行第j列的点对应的是Dot(j,i)，这是由于Dot的两个参数x，y分别代表的是横坐标和纵坐标，而横坐标所对应的是列数COL，纵坐标所对应的是行数ROW，是反过来的，不理解的话可以看一下下面的图:</li>
</ul>
</blockquote>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/iZdo/iZdo.github.io/blob/master/BlogImgs/Bolg3/Blog3_3.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<blockquote>
<ul>
<li>而由于这样i，j和j，i转换会混乱我们的思维，因此我们可以将这种转换封装成getDot()方法，方便我们转换的同时又不会混乱我们。</li>
<li>而最后的initGame()用于初始化所有点的状态，同样是用两层for循环，将所有点初始化为OFF状态，并且将一开始创建的Dot类型的cat猫初始化在(4,5)的位置，并且将其状态设置为IN。</li>
<li>最后我们需要定义一个常量BLOCKS表示随机添加的路障数量，并且在initGame()方法中用for循环随机设置路障位置。</li>
</ul>
</blockquote>
<h2 id="绘制场景"><a href="#绘制场景" class="headerlink" title="绘制场景"></a>绘制场景</h2><blockquote>
<ul>
<li>直接上代码:</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PlayGround</span> <span class="keyword">extends</span> <span class="title">SurfaceView</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> WIDTH = <span class="number">40</span>;</div><div class="line"></div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">redraw</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 获得Canvas画布实例</span></div><div class="line">        Canvas c = getHolder().lockCanvas();</div><div class="line">        <span class="comment">// 使用Canvas绘制背景</span></div><div class="line">        c.drawColor(Color.LTGRAY);</div><div class="line"></div><div class="line">        <span class="comment">// 创建画笔</span></div><div class="line">        Paint paint = <span class="keyword">new</span> Paint();</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ROW; i++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; COL; j++) &#123;</div><div class="line">                Dot one = getDot(j, i);</div><div class="line"></div><div class="line">                <span class="comment">// 根据点的状态设置画笔的颜色</span></div><div class="line">                <span class="keyword">switch</span> (one.getStatus()) &#123;</div><div class="line">                    <span class="keyword">case</span> Dot.STATUS_OFF:</div><div class="line">                        paint.setColor(<span class="number">0xFFEEEEEE</span>);</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    <span class="keyword">case</span> Dot.STATUS_ON:</div><div class="line">                        paint.setColor(<span class="number">0xFFFFAA00</span>);</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    <span class="keyword">case</span> Dot.STATUS_IN:</div><div class="line">                        paint.setColor(<span class="number">0xFFFF0000</span>);</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    <span class="keyword">default</span>:</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="comment">// 绘制圆点</span></div><div class="line">                c.drawOval(<span class="keyword">new</span> RectF(one.getX() * WIDTH , one.getY() * WIDTH,</div><div class="line">                        (one.getX() + <span class="number">1</span>) * WIDTH , (one.getY() + <span class="number">1</span>) * WIDTH), paint);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// 设置背景</span></div><div class="line">        getHolder().unlockCanvasAndPost(c);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">   ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>首先定义一个Paint，Paint类代表画笔，用来描述图形的颜色和风格，如线宽、颜色、透明度和填充效果等信息。</li>
<li>同样用两层for循环进行绘制，用一个switch语句判断当前点的状态并根据其状态将画笔设置成不同的颜色，然后调用drawOval方法绘制圆点。</li>
</ul>
</blockquote>
<h3 id="部署到Genymotion观看效果-1"><a href="#部署到Genymotion观看效果-1" class="headerlink" title="部署到Genymotion观看效果:"></a>部署到Genymotion观看效果:</h3><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/iZdo/iZdo.github.io/blob/master/BlogImgs/Bolg3/Blog3_4.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<blockquote>
<ul>
<li>这样一个10*10的矩阵就绘制出来了，但这明显不是我们想要的效果，缺少了偏移，但比较好实现，修改redraw()中的代码:</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">redraw</span><span class="params">()</span> </span>&#123;</div><div class="line">       ...</div><div class="line"></div><div class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ROW; i++) &#123;</div><div class="line">           <span class="keyword">int</span> offset = <span class="number">0</span>;</div><div class="line">           <span class="comment">// 偶数行偏移</span></div><div class="line">           <span class="keyword">if</span> (i % <span class="number">2</span> != <span class="number">0</span>) &#123;</div><div class="line">               offset = WIDTH / <span class="number">2</span>;</div><div class="line">           &#125;</div><div class="line"></div><div class="line">           <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; COL; j++) &#123;</div><div class="line">               </div><div class="line">               ...</div><div class="line">               </div><div class="line">               <span class="comment">// 绘制圆点</span></div><div class="line">               c.drawOval(<span class="keyword">new</span> RectF(one.getX() * WIDTH + offset, one.getY() * WIDTH,</div><div class="line">                       (one.getX() + <span class="number">1</span>) * WIDTH + offset, (one.getY() + <span class="number">1</span>) * WIDTH), paint);</div><div class="line">           &#125;</div><div class="line">       &#125;</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>添加一个偏移量offset，用if语句判断当偶数行时就将offset设置为WIDTH的一般，并且在绘制圆点时做出相应的修改，这样就完成了偏移。</li>
</ul>
</blockquote>
<h3 id="部署到Genymotion观看效果-2"><a href="#部署到Genymotion观看效果-2" class="headerlink" title="部署到Genymotion观看效果:"></a>部署到Genymotion观看效果:</h3><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/iZdo/iZdo.github.io/blob/master/BlogImgs/Bolg3/Blog3_5.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<blockquote>
<ul>
<li>这样错位偏移的效果也完成了，但是我们发现，绘制的圆点似乎不是很圆，边上会有类似锯齿一样的东西，这是由于我们用画笔画出来的图形是位图，是由一格一格像素组成的，所以会有锯齿，这是只要给画笔Paint设置抗锯齿就行了。</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">paint.setFlags(Paint.ANTI_ALIAS_FLAG);</div></pre></td></tr></table></figure>
<h3 id="观看效果"><a href="#观看效果" class="headerlink" title="观看效果:"></a>观看效果:</h3><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/iZdo/iZdo.github.io/blob/master/BlogImgs/Bolg3/Blog3_6.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<blockquote>
<ul>
<li>现在锯齿已经消失了，但是还有一个问题，我们可以看到，在模拟器上绘制的是一个10*10的矩阵，而由于模拟器分辨率比较高，所以在放满10个圆点之后还有一部分空白。</li>
</ul>
</blockquote>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/iZdo/iZdo.github.io/blob/master/BlogImgs/Bolg3/Blog3_7.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<blockquote>
<ul>
<li><p>这也许不会影响什么，但如果在分辨率较小的手机上运行，就会出现超出边界之类的问题了，所以我们需要适配一下屏幕。</p>
</li>
<li><p>要适配屏幕，就需要在Callback中的surfaceChanged()方法中定义了，这个方法我们可能还不知道是用来做什么的，但是我们通过查看AndroidAPI文档可以知道，surfaceChanged()的最后两个参数分别代表的是surfaceView的宽和高。</p>
</li>
</ul>
</blockquote>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/iZdo/iZdo.github.io/blob/master/BlogImgs/Bolg3/Blog3_8.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<h3 id="修改surfaceChanged-方法"><a href="#修改surfaceChanged-方法" class="headerlink" title="修改surfaceChanged()方法"></a>修改surfaceChanged()方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">surfaceChanged</span><span class="params">(SurfaceHolder surfaceHolder, <span class="keyword">int</span> i, <span class="keyword">int</span> i1, <span class="keyword">int</span> i2)</span> </span>&#123;</div><div class="line">       WIDTH = i1 / (COL + <span class="number">1</span>);</div><div class="line">       redraw();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>将WIDTH动态地设置成与surfaceView的宽相关的值，这样就可以适配其他分比率的屏幕了。</li>
<li>ps:为什么要除以(COL+1)而不是COL呢?这是因为我们绘制的场景要有偏移的效果，如果我们只除以COL的话，就只能恰好满足十列的宽度，也就是第一行的宽度，但由于第二行是向右偏倚了一个半径的宽度，所以如果只除以COL的话第二行最后一个圆点的一半会在屏幕之外，这样的用户体验是非常不好的，所以需要多加一个宽度来将偶数行也适配进去。</li>
</ul>
</blockquote>
<h3 id="观看效果-1"><a href="#观看效果-1" class="headerlink" title="观看效果:"></a>观看效果:</h3><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/iZdo/iZdo.github.io/blob/master/BlogImgs/Bolg3/Blog3_9.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<blockquote>
<ul>
<li>可以看到，屏幕适配也成功了。</li>
<li>这样一来，场景绘制的工作也完成了。</li>
</ul>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;使用Android制作围住神经猫游戏-一&quot;&gt;&lt;a href=&quot;#使用Android制作围住神经猫游戏-一&quot; class=&quot;headerlink&quot; title=&quot;使用Android制作围住神经猫游戏(一)&quot;&gt;&lt;/a&gt;使用Android制作围住神经猫游戏(一)&lt;/h1
    
    </summary>
    
      <category term="Android" scheme="https://izdo.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://izdo.github.io/tags/Android/"/>
    
      <category term="demo" scheme="https://izdo.github.io/tags/demo/"/>
    
  </entry>
  
  <entry>
    <title>如何做一个简单的通讯录</title>
    <link href="https://izdo.github.io/2017/03/26/%E5%88%B6%E4%BD%9C%E9%80%9A%E8%AE%AF%E5%BD%95/"/>
    <id>https://izdo.github.io/2017/03/26/制作通讯录/</id>
    <published>2017-03-26T14:05:59.634Z</published>
    <updated>2017-04-06T12:42:17.985Z</updated>
    
    <content type="html"><![CDATA[<h1 id="如何做一个简单的通讯录"><a href="#如何做一个简单的通讯录" class="headerlink" title="如何做一个简单的通讯录"></a>如何做一个简单的通讯录</h1><h2 id="获取手机通讯录信息"><a href="#获取手机通讯录信息" class="headerlink" title="获取手机通讯录信息"></a>获取手机通讯录信息</h2><h3 id="创建新工程GetMyPhoneContacts"><a href="#创建新工程GetMyPhoneContacts" class="headerlink" title="创建新工程GetMyPhoneContacts"></a>创建新工程GetMyPhoneContacts</h3><h3 id="为了模拟通讯录的效果，现在genymotion模拟器中添加几个联系人"><a href="#为了模拟通讯录的效果，现在genymotion模拟器中添加几个联系人" class="headerlink" title="为了模拟通讯录的效果，现在genymotion模拟器中添加几个联系人"></a>为了模拟通讯录的效果，现在genymotion模拟器中添加几个联系人</h3><ul>
<li><h3 id="效果图"><a href="#效果图" class="headerlink" title="效果图:"></a>效果图:</h3><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/iZdo/iZdo.github.io/blob/master/BlogImgs/Blog2/Blog2_1.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
</li>
</ul>
<h3 id="创建Java类-GetNumber"><a href="#创建Java类-GetNumber" class="headerlink" title="创建Java类 GetNumber"></a>创建Java类 GetNumber</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.getmyphonecontacts;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.database.Cursor;</div><div class="line"><span class="keyword">import</span> android.provider.ContactsContract.CommonDataKinds.Phone;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by iZdo on 2017/3/26.</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GetNumber</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getNumber</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="comment">// 查询系统通讯录</span></div><div class="line">        Cursor cursor = context.getContentResolver().query(Phone.CONTENT_URI, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</div><div class="line"></div><div class="line">        <span class="comment">// 定义两个字符串用于获取姓名和电话号码</span></div><div class="line">        String phoneName;</div><div class="line">        String phoneNumber;</div><div class="line"></div><div class="line">        <span class="comment">// 循环遍历</span></div><div class="line">        <span class="keyword">while</span> (cursor.moveToNext()) &#123;</div><div class="line">            phoneName = cursor.getString(cursor.getColumnIndex(Phone.DISPLAY_NAME));</div><div class="line">            phoneNumber = cursor.getString(cursor.getColumnIndex(Phone.NUMBER));</div><div class="line">             Log.d(<span class="string">"MainActivity"</span>, <span class="string">"phoneName= "</span> + phoneName + <span class="string">",phoneNumber= "</span> + phoneNumber);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>类中只有一个getNumber方法，这个方法用于获取手机通讯录的联系人</li>
<li>这个方法需要一个上下文Context对象作为参数，首先调用上下文的getContentResolver()方法获取一个内容解析者ContentResolver对象并且调用其query()方法查询系统联系人</li>
<li>query()方法第一个参数为一个Uri，这里传入Phone.CONTENT_URI即可，后面的四个参数为查询条件，目前我们不需要筛选联系人，因此全部传入null即可。</li>
<li>query()返回的是一个游标Cursor，用while循环不断遍历Cursor，从Cursor中取出联系人的姓名和号码。</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.getmyphonecontacts;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        GetNumber.getNumber(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>在MAinActivity中调用GetNumber的getNumber()方法。</li>
</ul>
</blockquote>
<h4 id="打印日志如下"><a href="#打印日志如下" class="headerlink" title="打印日志如下:"></a>打印日志如下:</h4><blockquote>
<p>D/MainActivity: <strong>phoneName= zhangsan,phoneNumber= 110</strong></p>
<p>D/MainActivity: <strong>phoneName= lisi,phoneNumber= 119</strong></p>
<p>D/MainActivity: <strong>phoneName= lin,phoneNumber= 666</strong></p>
<ul>
<li>可以看到，打印的结果和通讯录中的联系人吻合。</li>
</ul>
</blockquote>
<h1 id="封装数据"><a href="#封装数据" class="headerlink" title="封装数据"></a>封装数据</h1><blockquote>
<ul>
<li>现在要做的是将得到的数据封装起来<h2 id="新建Java类ContactInfo"><a href="#新建Java类ContactInfo" class="headerlink" title="新建Java类ContactInfo"></a>新建Java类ContactInfo</h2></li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.getmyphonecontacts;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by iZdo on 2017/3/27.</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ContactInfo</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String number;</div><div class="line"></div><div class="line">    <span class="comment">// 构造器</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ContactInfo</span><span class="params">(String name, String number)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">        <span class="keyword">this</span>.number = number;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 对应的getter、setter方法</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNumber</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> number;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNumber</span><span class="params">(String number)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.number = number;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>简单的JavaBean类，不多做解释 </li>
<li>ps:number使用String类型而不适用int类型是因为号码会有地区之分，所以会出现”+86”的情况，所以不能只用int类型来存储。</li>
</ul>
</blockquote>
<h2 id="修改GetNumber中的代码"><a href="#修改GetNumber中的代码" class="headerlink" title="修改GetNumber中的代码:"></a>修改GetNumber中的代码:</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GetNumber</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;ContactInfo&gt; contactInfoList = <span class="keyword">new</span> ArrayList&lt;ContactInfo&gt;();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getNumber</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line"></div><div class="line">        ...</div><div class="line"></div><div class="line">        <span class="comment">// 循环遍历</span></div><div class="line">        <span class="keyword">while</span> (cursor.moveToNext()) &#123;</div><div class="line">            phoneName = cursor.getString(cursor.getColumnIndex(Phone.DISPLAY_NAME));</div><div class="line">            phoneNumber = cursor.getString(cursor.getColumnIndex(Phone.NUMBER));</div><div class="line">            ContactInfo contactInfo = <span class="keyword">new</span> ContactInfo(phoneName, phoneNumber);</div><div class="line">            contactInfoList.add(contactInfo);</div><div class="line">            Log.d(<span class="string">"MainActivity"</span>, <span class="string">"phoneName= "</span> + phoneName + <span class="string">",phoneNumber= "</span> + phoneNumber);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li><p>GetNumber中新创建了一个数据类型为ContactInfo的List集合，在getNumber()方法的while循环中，每一次循环都将新创建一个ContactInfo对象，并将获取的联系人姓名和号码存入ContactInfo对象中，再将其加入到List集合里，这样就将所有的联系人都存入到了List集合，实现了数据的封装。</p>
</li>
<li><p>ps:显示中的通讯录实际上不止姓名和号码两项，还有地址，电子邮箱等信息，这里为了方便救只使用姓名和号码这两项。</p>
</li>
</ul>
</blockquote>
<h1 id="UI适配"><a href="#UI适配" class="headerlink" title="UI适配"></a>UI适配</h1><h2 id="修改activity-main-xml文件"><a href="#修改activity-main-xml文件" class="headerlink" title="修改activity_main.xml文件"></a>修改activity_main.xml文件</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span></span></div><div class="line">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/activity_main"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">tools:context</span>=<span class="string">"com.getmyphonecontacts.MainActivity"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">ListView</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/lv"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        /&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>这里使用ListView用于联系人数据的显示。</li>
</ul>
</blockquote>
<h2 id="自定义适配器"><a href="#自定义适配器" class="headerlink" title="自定义适配器"></a>自定义适配器</h2><h3 id="新建MyAdapter继承自BaseAdapter"><a href="#新建MyAdapter继承自BaseAdapter" class="headerlink" title="新建MyAdapter继承自BaseAdapter"></a>新建MyAdapter继承自BaseAdapter</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.getmyphonecontacts;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.view.ViewGroup;</div><div class="line"><span class="keyword">import</span> android.widget.BaseAdapter;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by iZdo on 2017/3/27.</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAdapter</span> <span class="keyword">extends</span> <span class="title">BaseAdapter</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> List&lt;ContactInfo&gt; mContactInfoList;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Context mContext;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyAdapter</span><span class="params">(List&lt;ContactInfo&gt; contactInfoList, Context context)</span> </span>&#123;</div><div class="line">        mContactInfoList = contactInfoList;</div><div class="line">        mContext = context;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mContactInfoList.size();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mContactInfoList.get(i);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getItemId</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> i;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> i, View view, ViewGroup viewGroup)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>此处需要创建一个数据类型为ContactInfo的List集合和一个上下文对象COntext。</li>
<li>再创建一个构造器，其参数为一个List集合和一个上下文对象。</li>
<li>继承BaseAdapter需要重写四个方法:getCount()、getItem()、getItemId()、getView():<ul>
<li>public int getCount():用于得到Item的总数，这里返回我们创建的List集合的长度即可。</li>
<li>public Object getItem(int i):用于根据i得到某个Item的对象，这里需要返回List集合对应位置i的对象。</li>
<li>public long getItemId(int i):用于根据i得到某个Item的id，由于位置i代表的就是其相应Item的id，这里返回i即可。</li>
<li>public View getView(int i, View view, ViewGroup viewGroup):用于得到相应的i对应的Item视图，i当前的位置以及converView复用的View对象，在写这个方法之前，我们需要再新建一个Item布局来展示具体数据。</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id="新建布局文件contact-xml"><a href="#新建布局文件contact-xml" class="headerlink" title="新建布局文件contact.xml"></a>新建布局文件contact.xml</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">              <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">              <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">              <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">RelativeLayout</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">            <span class="attr">android:id</span>=<span class="string">"@+id/iv"</span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:src</span>=<span class="string">"@mipmap/ic_launcher"</span>/&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:layout_alignBottom</span>=<span class="string">"@id/iv"</span></div><div class="line">            <span class="attr">android:layout_alignTop</span>=<span class="string">"@id/iv"</span></div><div class="line">            <span class="attr">android:layout_toRightOf</span>=<span class="string">"@id/iv"</span></div><div class="line">            <span class="attr">android:gravity</span>=<span class="string">"center_vertical"</span></div><div class="line">            <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line"></div><div class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">                <span class="attr">android:id</span>=<span class="string">"@+id/name"</span></div><div class="line">                <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">                <span class="attr">android:text</span>=<span class="string">"111"</span></div><div class="line">                <span class="attr">android:textSize</span>=<span class="string">"15sp"</span>/&gt;</div><div class="line"></div><div class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">                <span class="attr">android:id</span>=<span class="string">"@+id/number"</span></div><div class="line">                <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">                <span class="attr">android:text</span>=<span class="string">"222"</span></div><div class="line">                <span class="attr">android:textSize</span>=<span class="string">"10sp"</span>/&gt;</div><div class="line">        <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li><h3 id="效果图如下"><a href="#效果图如下" class="headerlink" title="效果图如下:"></a>效果图如下:</h3><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/iZdo/iZdo.github.io/blob/master/BlogImgs/Blog2/Blog2_2.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<blockquote>
<ul>
<li>简单的布局，左边是一个ImageView，右边是两个TextView，具体实现如代码所示，此处不再阐述。</li>
</ul>
</blockquote>
</li>
</ul>
<h2 id="修改MyAdapter的代码"><a href="#修改MyAdapter的代码" class="headerlink" title="修改MyAdapter的代码"></a>修改MyAdapter的代码</h2><h3 id="将getView-方法的内容补充完整"><a href="#将getView-方法的内容补充完整" class="headerlink" title="将getView()方法的内容补充完整"></a>将getView()方法的内容补充完整</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> i, View view, ViewGroup viewGroup)</span> </span>&#123;</div><div class="line">    LayoutInflater inflater = LayoutInflater.from(mContext);</div><div class="line">    LinearLayout layout = (LinearLayout) inflater.inflate(R.layout.contact, <span class="keyword">null</span>);</div><div class="line">    TextView nametv = (TextView) layout.findViewById(R.id.name);</div><div class="line">    TextView numbertv = (TextView) layout.findViewById(R.id.number);</div><div class="line">    nametv.setText(mContactInfoList.get(i).getName());</div><div class="line">    numbertv.setText(mContactInfoList.get(i).getNumber());</div><div class="line">    <span class="keyword">return</span> layout;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>首先创建一个打气筒将刚才创建的Item布局文件转化为一个View，然后初始化两个TextView控件并为其填充相应位置的联系人信息，最后将layout返回。</li>
<li>ps:LayoutInflater.from()方法需要传入一个上下文对象Context，这里就需要用到此前创建的成员变量mContext，而mContext是通过构造器得到的，因此在构造器里设置Context为参数的好处就是当某个活动创建我们自定义的适配器MyAdapter的时候就会同时将其上下文传入，使得活动与适配器联系了起来。</li>
</ul>
</blockquote>
<h2 id="修改MainActivity中的代码"><a href="#修改MainActivity中的代码" class="headerlink" title="修改MainActivity中的代码"></a>修改MainActivity中的代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.getmyphonecontacts;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.widget.ListView;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ListView lv;</div><div class="line">    <span class="keyword">private</span> MyAdapter mAdapter;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        GetNumber.getNumber(<span class="keyword">this</span>);</div><div class="line">        lv = (ListView) findViewById(R.id.lv);</div><div class="line">        mAdapter = <span class="keyword">new</span> MyAdapter(GetNumber.contactInfoList, <span class="keyword">this</span>);</div><div class="line">        lv.setAdapter(mAdapter);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<ol>
<li>创建一个ListView</li>
<li>创建一个MyAdapter适配器</li>
</ol>
<ul>
<li>这里没什么好说的，需要注意的一点是MyAdapter的两个参数分别传入GetNumber中的List集合(静态成员变量，可通过类名直接调用)和this即可。</li>
</ul>
</blockquote>
<h2 id="部署到Genymotion模拟器上观看效果"><a href="#部署到Genymotion模拟器上观看效果" class="headerlink" title="部署到Genymotion模拟器上观看效果"></a>部署到Genymotion模拟器上观看效果</h2><h3 id="效果如下"><a href="#效果如下" class="headerlink" title="效果如下:"></a>效果如下:</h3><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/iZdo/iZdo.github.io/blob/master/BlogImgs/Blog2/Blog2_3.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<blockquote>
<ul>
<li>可以看到，联系人的信息都显示在了每一行Item上了。</li>
<li>ps:ImageView上的图片事先并无准备，所以就用了系统自带的ic_launcher图片。</li>
</ul>
</blockquote>
<h2 id="复用历史缓存对象进行优化"><a href="#复用历史缓存对象进行优化" class="headerlink" title="复用历史缓存对象进行优化"></a>复用历史缓存对象进行优化</h2><blockquote>
<ul>
<li>ListView其实是一个比较难用的控件，因为它有很多细节可以优化，运行效率就是其中很重要的一点，我们上面写的ListView运行效率是很低的，因为在getView()方法中，每次都将布局重新加载了一遍，当ListView快速滚动的时候，会明显出现卡顿的现象(由于我们的数据量比较少，无法体现出卡顿效果，当数据量比较大的时候能够明显看出)，这时候我们就需要优化ListView的，我们可以发现getView()方法里还有一个view(原先是convertView)是我们没用到的，这是一个缓存对象，就是用于优化ListView的。</li>
</ul>
</blockquote>
<h3 id="修改MyAdapter中的代码"><a href="#修改MyAdapter中的代码" class="headerlink" title="修改MyAdapter中的代码:"></a>修改MyAdapter中的代码:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAdapter</span> <span class="keyword">extends</span> <span class="title">BaseAdapter</span> </span>&#123;</div><div class="line"></div><div class="line">   ...</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> i, View view, ViewGroup viewGroup)</span> </span>&#123;</div><div class="line">        <span class="comment">//        LayoutInflater inflater = LayoutInflater.from(mContext);</span></div><div class="line">        <span class="comment">//        LinearLayout layout = (LinearLayout) inflater.inflate(R.layout.contact, null);</span></div><div class="line">        <span class="comment">//        TextView nametv = (TextView) layout.findViewById(R.id.name);</span></div><div class="line">        <span class="comment">//        TextView numbertv = (TextView) layout.findViewById(R.id.number);</span></div><div class="line">        <span class="comment">//        nametv.setText(mContactInfoList.get(i).getName());</span></div><div class="line">        <span class="comment">//        numbertv.setText(mContactInfoList.get(i).getNumber());</span></div><div class="line">        ViewHolder holder;</div><div class="line">        <span class="keyword">if</span> (view == <span class="keyword">null</span>) &#123;</div><div class="line">            view = LayoutInflater.from(mContext).inflate(R.layout.contact, <span class="keyword">null</span>);</div><div class="line">            holder = <span class="keyword">new</span> ViewHolder();</div><div class="line">            holder.nametv = (TextView) view.findViewById(R.id.name);</div><div class="line">            holder.numbertv = (TextView) view.findViewById(R.id.number);</div><div class="line">            holder.nametv.setText(mContactInfoList.get(i).getName());</div><div class="line">            holder.numbertv.setText(mContactInfoList.get(i).getNumber());</div><div class="line">            view.setTag(holder);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            holder = (ViewHolder) view.getTag();</div><div class="line">            holder.nametv.setText(mContactInfoList.get(i).getName());</div><div class="line">            holder.numbertv.setText(mContactInfoList.get(i).getNumber());</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> view;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span> </span>&#123;</div><div class="line">        TextView nametv;</div><div class="line">        TextView numbertv;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>首先创建了一个内部类ViewHolder，用于对控件的实例进行缓存。</li>
<li>在getView方法中，创建了一个ViewHolder对象，当缓存view为空时，就将联系人的信息封装在ViewHolder里，然后调用setTag()方法将ViewHolder储存在view中，而当缓存不为空时，就调用getTag()方法取出ViewHolder，这样就实现了缓存的复用。</li>
</ul>
</blockquote>
<h3 id="继续改进"><a href="#继续改进" class="headerlink" title="继续改进"></a>继续改进</h3><blockquote>
<ul>
<li>通过复用缓存对象我们对ListView进行了优化，而通过观察getView()方法，我们发现不管缓存view为空时，新建ViewHolder去缓存实例还是缓存view不为空时，取出缓存，我们都需要用这个ViewHolder对TextView进行设置文本内容，所以我们又可以进一步优化代码:</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAdapter</span> <span class="keyword">extends</span> <span class="title">BaseAdapter</span> </span>&#123;</div><div class="line"></div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> i, View view, ViewGroup viewGroup)</span> </span>&#123;</div><div class="line">       </div><div class="line">       ...</div><div class="line">       </div><div class="line">        ViewHolder holder;</div><div class="line">        <span class="keyword">if</span> (view == <span class="keyword">null</span>) &#123;</div><div class="line">            view = LayoutInflater.from(mContext).inflate(R.layout.contact, <span class="keyword">null</span>);</div><div class="line">            holder = <span class="keyword">new</span> ViewHolder();</div><div class="line">            holder.nametv = (TextView) view.findViewById(R.id.name);</div><div class="line">            holder.numbertv = (TextView) view.findViewById(R.id.number);</div><div class="line">            view.setTag(holder);</div><div class="line">        &#125; <span class="keyword">else</span></div><div class="line">            holder = (ViewHolder) view.getTag();</div><div class="line">        holder.nametv.setText(mContactInfoList.get(i).getName());</div><div class="line">        holder.numbertv.setText(mContactInfoList.get(i).getNumber());</div><div class="line"></div><div class="line">        <span class="keyword">return</span> view;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">   ...</div><div class="line">   </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>这里我们将holder.nametv.setText(mContactInfoList.get(i).getName())和     holder.numbertv.setText(mContactInfoList.get(i).getNumber())放到判断语句外边，减少了代码的重复(其实就是之前忘了放)。</li>
</ul>
</blockquote>
<p>这样就完成了从手机系统通讯录中取出数据放到我们自己的通讯录上的效果。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;如何做一个简单的通讯录&quot;&gt;&lt;a href=&quot;#如何做一个简单的通讯录&quot; class=&quot;headerlink&quot; title=&quot;如何做一个简单的通讯录&quot;&gt;&lt;/a&gt;如何做一个简单的通讯录&lt;/h1&gt;&lt;h2 id=&quot;获取手机通讯录信息&quot;&gt;&lt;a href=&quot;#获取手机通讯录信
    
    </summary>
    
      <category term="Android" scheme="https://izdo.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://izdo.github.io/tags/Android/"/>
    
      <category term="demo" scheme="https://izdo.github.io/tags/demo/"/>
    
  </entry>
  
  <entry>
    <title>如何做一个简单的倒计时</title>
    <link href="https://izdo.github.io/2017/03/25/%E5%88%B6%E4%BD%9C%E5%80%92%E8%AE%A1%E6%97%B6/"/>
    <id>https://izdo.github.io/2017/03/25/制作倒计时/</id>
    <published>2017-03-25T08:36:11.032Z</published>
    <updated>2017-04-06T12:43:41.271Z</updated>
    
    <content type="html"><![CDATA[<h1 id="如何做一个简单的倒计时"><a href="#如何做一个简单的倒计时" class="headerlink" title="如何做一个简单的倒计时"></a>如何做一个简单的倒计时</h1><h2 id="1-创建新工程CountTime"><a href="#1-创建新工程CountTime" class="headerlink" title="1. 创建新工程CountTime"></a>1. 创建新工程CountTime</h2><h2 id="2-布局文件activity-main-xml"><a href="#2-布局文件activity-main-xml" class="headerlink" title="2. 布局文件activity_main.xml:"></a>2. 布局文件activity_main.xml:</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/activity_main"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></div><div class="line">    <span class="attr">tools:context</span>=<span class="string">"com.counttime.MainActivity"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/inputtime"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:ems</span>=<span class="string">"10"</span>/&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/gettime"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"获取倒计时时间"</span>/&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/time"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>/&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/starttime"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"开始计时"</span>/&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/stoptime"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"停止计时"</span>/&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<blockquote>
<p>inputtime用于输入倒计时时间<br>gettime用于显示inputtime输入的时间<br>time用于显示倒计时时间<br>starttime、stoptime分别用于开始和停止倒计时</p>
</blockquote>
<ul>
<li><h3 id="效果图"><a href="#效果图" class="headerlink" title="效果图:"></a>效果图:</h3></li>
</ul>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/iZdo/iZdo.github.io/blob/master/BlogImgs/Blog1/Blog1_1.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<h2 id="3-MainActivity逻辑"><a href="#3-MainActivity逻辑" class="headerlink" title="3. MainActivity逻辑:"></a>3. MainActivity逻辑:</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.counttime;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.os.Handler;</div><div class="line"><span class="keyword">import</span> android.os.Message;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.Button;</div><div class="line"><span class="keyword">import</span> android.widget.EditText;</div><div class="line"><span class="keyword">import</span> android.widget.TextView;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.Timer;</div><div class="line"><span class="keyword">import</span> java.util.TimerTask;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> EditText inputet;</div><div class="line">    <span class="keyword">private</span> Button getTime, startTime, stopTime;</div><div class="line">    <span class="keyword">private</span> TextView time;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> i = <span class="number">0</span>;</div><div class="line">    <span class="keyword">private</span> Timer timer = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">private</span> TimerTask task = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        <span class="comment">//调用初始化控件方法</span></div><div class="line">        initView();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 初始化控件</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">()</span> </span>&#123;</div><div class="line">        inputet = (EditText) findViewById(R.id.inputtime);</div><div class="line">        getTime = (Button) findViewById(R.id.gettime);</div><div class="line">        startTime = (Button) findViewById(R.id.starttime);</div><div class="line">        stopTime = (Button) findViewById(R.id.stoptime);</div><div class="line">        time = (TextView) findViewById(R.id.time);</div><div class="line">        getTime.setOnClickListener(<span class="keyword">this</span>);</div><div class="line">        startTime.setOnClickListener(<span class="keyword">this</span>);</div><div class="line">        stopTime.setOnClickListener(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 设置点击事件</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        <span class="keyword">switch</span> (view.getId()) &#123;</div><div class="line">            <span class="comment">// 点击gettime按钮获取inputet上的时间值</span></div><div class="line">            <span class="keyword">case</span> R.id.gettime:</div><div class="line">                time.setText(inputet.getText().toString());</div><div class="line">                i = Integer.parseInt(inputet.getText().toString());</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> R.id.starttime:</div><div class="line">                startTime();</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> R.id.stoptime:</div><div class="line">                stopTime();</div><div class="line">                <span class="keyword">break</span>;</div><div class="line"></div><div class="line">            <span class="keyword">default</span>:</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 使用Handler实现对主线程的更新UI操作</span></div><div class="line">    <span class="keyword">private</span> Handler mHandler = <span class="keyword">new</span> Handler() &#123;</div><div class="line">        <span class="comment">// 调用handleMessage处理消息</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</div><div class="line">            time.setText(msg.arg1 + <span class="string">""</span>);</div><div class="line">            startTime();</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startTime</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 创建计时器和计时任务</span></div><div class="line">        timer = <span class="keyword">new</span> Timer();</div><div class="line">        task = <span class="keyword">new</span> TimerTask() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                i--;</div><div class="line">                Message message = mHandler.obtainMessage();</div><div class="line">                message.arg1 = i;</div><div class="line">                mHandler.sendMessage(message);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        timer.schedule(task, <span class="number">1000</span>);</div><div class="line">    &#125;</div><div class="line">   </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stopTime</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 取消计时器</span></div><div class="line">        timer.cancel();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li><p>由于主线程不允许子线程更新UI，因此这里需要用到Handler实现子线程更新UI的操作。</p>
</li>
<li><p>首先创建一个Handler并调用handleMessage方法处理sendMessage传递过来的消息，需要注意的是，TextView的setText方法只能传入String类型的参数，因此不能单单传入msg.arg1，一种简单的处理方式就是在后面加上“”将其转换成字符串:time.setText(msg.arg1 + “”);。</p>
</li>
<li><p>Timer和TimerTask一般是配合使用的(由TimerTask实现任务内容，然后将任务放入计时器Timer),在TimerTask的run()方法里创建一个Message用于向Handler发送消息，这里传入的是i(此前已经将inputet中的数字赋给i)，并调用sendMessage方法将Message发送给Handler，最后调用schedule()方法将TimerTask放入计时器。</p>
</li>
<li><p>timer.schedule(task, 1);第一个参数表示要放入的TimerTask任务，第二个参数是一个毫秒值，表示多少时间之后启动任务，这里放入1000毫秒(1秒)。</p>
</li>
<li><p>最后调用cancel()方法取消任务。</p>
</li>
<li><p>ps:在startTime()中调用sendMessage()方法向Handler发送消息，而在Handler的handleMessage中又调用startTime()方法，这样就形成了sendMessage()-&gt;handleMessage()-&gt;sendMessage()-&gt;handleMessage()-&gt;…的循环。</p>
</li>
</ul>
</blockquote>
<h2 id="4-部署到Genymotion观看效果"><a href="#4-部署到Genymotion观看效果" class="headerlink" title="4. 部署到Genymotion观看效果:"></a>4. 部署到Genymotion观看效果:</h2><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/iZdo/iZdo.github.io/blob/master/BlogImgs/Blog1/Blog1_2.gif?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<h2 id="5-改进"><a href="#5-改进" class="headerlink" title="5. 改进"></a>5. 改进</h2><blockquote>
<p>这里存在这一个问题就是计时器读数到0后会变成负数，所以下面需要修改一些代码使计时器归0后停止计时。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startTime</span><span class="params">()</span> </span>&#123;</div><div class="line">        ...</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                i--;</div><div class="line">                <span class="keyword">if</span>(i&lt;<span class="number">0</span>)&#123;</div><div class="line">                    stopTime();</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">        ...</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<ul>
<li><p>这里在startTime()方法中的run()方法中加入一个if判断，当i小于0的时候就调用stopTime()方法并且return。(这里判断条件是小于0而不是等于0是逻辑顺序的问题)</p>
</li>
<li><p>为了更好地看到”刹车”效果，将任务间隔设置为1毫秒。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">timer.schedule(task, <span class="number">1</span>);</div></pre></td></tr></table></figure>
</li>
<li><h3 id="效果如下"><a href="#效果如下" class="headerlink" title="效果如下:"></a>效果如下:</h3></li>
</ul>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/iZdo/iZdo.github.io/blob/master/BlogImgs/Blog1/Blog1_3.gif?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<blockquote>
<p>对于目前的程序，由于从inputet获取的值为int类型，但当我们输入小数或者字符和其他符号时，程序会崩溃，这里可以使用正则表达式限制输入。</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;如何做一个简单的倒计时&quot;&gt;&lt;a href=&quot;#如何做一个简单的倒计时&quot; class=&quot;headerlink&quot; title=&quot;如何做一个简单的倒计时&quot;&gt;&lt;/a&gt;如何做一个简单的倒计时&lt;/h1&gt;&lt;h2 id=&quot;1-创建新工程CountTime&quot;&gt;&lt;a href=&quot;#1
    
    </summary>
    
      <category term="Android" scheme="https://izdo.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://izdo.github.io/tags/Android/"/>
    
      <category term="demo" scheme="https://izdo.github.io/tags/demo/"/>
    
  </entry>
  
</feed>
